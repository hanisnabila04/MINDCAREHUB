<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Appointments - MindCareHub</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
  <link rel="stylesheet" href="css/style.css">
</head>

<style>
  /* === STANDARD STYLES (FROM CLIENTS.HTML) === */
  html { scroll-behavior: smooth; }
  body { background-color: #f8f9fa; font-family: 'Roboto', sans-serif; color: #333; overflow-x: hidden; }
  
  /* Sidebar */
  .sidebar { background-color: #102e35; width: 250px; min-height: 100vh; transition: width 0.25s ease; display: flex; flex-direction: column; z-index: 100; position: relative; }
  .sidebar.collapsed { width: 60px; padding: 0 10px; text-align: center; }
  .sidebar.collapsed .label, .sidebar.collapsed .text-center, .sidebar.collapsed .profile-icons, .sidebar.collapsed .nav-header { display: none !important; }
  .sidebar-toggle-btn { position: absolute; right: -15px; top: 20px; width: 30px; height: 30px; border-radius: 50%; background: white; border: 1px solid #ddd; display: flex; align-items: center; justify-content: center; cursor: pointer; z-index: 101; }
  .sidebar .nav-link { color: #b0c4c9; font-weight: 500; padding: 12px 15px; margin-bottom: 5px; border-radius: 6px; }
  .sidebar .nav-link:hover { color: #fff; background-color: rgba(255,255,255,0.1); }
  .sidebar .nav-link.active { background-color: #bddeb1; color: #102e35; font-weight: bold; }
  .profile-icon { width: 60px; height: 60px; background: rgba(255,255,255,0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 2rem; color: white; margin: 0 auto; }
  
  /* Layout */
  .content { display: flex; flex-direction: column; min-height: 100vh; width: 100%; }
  .navbar { background-color: #FFFFFF; border-bottom: 1px solid #e0e0e0; padding: 10px 20px; }
  .brand-rgb { font-weight: 800; background: linear-gradient(90deg, #22c55e, #10b981, #3b82f6, #f59e0b, #f43f5e, #22c55e); background-size: 300% 300%; -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; animation: rgbMove 4s ease-in-out infinite; }
  @keyframes rgbMove { 0% { background-position: 0% 50%; } 100% { background-position: 100% 50%; } }
  
  /* Footer */
  footer { background-color: #FFFFFF; color: #333; padding: 40px 0 20px 0; margin-top: auto; border-top: 1px solid #e0e0e0; }
  .social-icon-btn { font-size: 1.5rem; margin: 0 12px; color: #444; transition: all 0.3s ease; display: inline-block; }
  .social-icon-btn:hover { transform: translateY(-4px); background: linear-gradient(90deg, #22c55e, #3b82f6, #f43f5e); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; }
  .footer-links a { margin: 0 10px; font-weight: 500; text-decoration: none; color: #555; } 
  .footer-links a:hover { color: #198754; }

  /* Profile Utils */
  .hidden-section { display: none !important; }
  .profile-grid { display: grid; grid-template-columns: 350px 1fr; gap: 24px; margin-top: 20px; }
  .profile-card { background: #FFFFFF; border-radius: 12px; padding: 30px; box-shadow: 0 2px 12px rgba(0,0,0,0.04); border: 1px solid #f0f0f0; height: 100%; }
  .avatar-large { width: 100px; height: 100px; border-radius: 50%; background-color: #eef2ff; color: #102e35; font-size: 2rem; font-weight: bold; display: flex; align-items: center; justify-content: center; margin-bottom: 15px; }
  .btn-green { background-color: #198754; color: white; border: none; font-weight: 500; }
  .btn-outline-custom { border: 1px solid #dee2e6; color: #555; background: white; font-weight: 500; }

  /* === APPOINTMENT SPECIFIC STYLES === */
  /* Parallax Banner */
  .welcome-card {
    background-color: #102e35;
    background-image: linear-gradient(to right, rgba(16, 46, 53, 0.9), rgba(16, 46, 53, 0.6)), 
                      url('https://images.unsplash.com/photo-1576091160399-112ba8d25d1d?q=80&w=1470&auto=format&fit=crop');
    background-attachment: fixed; background-position: center; background-size: cover;
    padding: 40px; border-radius: 16px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15); color: white; margin-bottom: 30px; position: relative; overflow: hidden;
  }
  
  /* Animations */
  @keyframes fadeUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
  .animate-entry { animation: fadeUp 0.6s ease-out forwards; opacity: 0; }
  .delay-1 { animation-delay: 0.1s; } .delay-2 { animation-delay: 0.2s; } .delay-3 { animation-delay: 0.3s; }

  /* Stats & Timeline */
  .stat-card-mini { background: white; border-radius: 12px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); border: 1px solid #f0f0f0; display: flex; justify-content: space-between; align-items: center; transition: transform 0.2s; }
  .stat-card-mini:hover { transform: translateY(-5px); }
  .icon-square { width: 45px; height: 45px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; }
  
  .timeline-wrapper { display: flex; gap: 15px; overflow-x: auto; padding-bottom: 15px; margin-bottom: 20px; }
  .timeline-card { flex: 0 0 260px; background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); border-radius: 12px; padding: 15px; border-left: 4px solid #10b981; box-shadow: 0 4px 12px rgba(0,0,0,0.05); position: relative; transition: transform 0.2s; }
  .timeline-card:hover { transform: scale(1.02); }
  .timeline-card.pending { border-left-color: #f59e0b; }
  .time-badge { background: #102e35; color: white; font-weight: bold; padding: 4px 10px; border-radius: 6px; font-size: 0.8rem; display: inline-block; margin-bottom: 8px; }

  /* Kanban & Table */
  .kanban-container { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; }
  @media(max-width: 992px) { .kanban-container { grid-template-columns: 1fr; } }
  .kanban-col { background: #eef2f5; border-radius: 12px; padding: 15px; height: 100%; border: 1px solid #dee2e6; }
  .kanban-card { background: white; border-radius: 8px; padding: 15px; margin-bottom: 15px; box-shadow: 0 2px 4px rgba(0,0,0,0.03); border-left: 3px solid #102e35; transition: transform 0.2s; }
  .table-card { background: white; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.03); overflow: hidden; }
  .view-btn { border: 1px solid #dee2e6; background: white; color: #555; }
  .view-btn.active { background: #102e35; color: white; border-color: #102e35; }
  th { background-color: #bddeb1; color: #102e35; padding: 15px; font-weight: 800; border:none; }
  td { background-color: #FFFFFF; padding: 15px; border-bottom: 1px solid #f1f1f1; vertical-align: middle; }
  .avatar-text { width: 32px; height: 32px; border-radius: 50%; background: #e0f2f1; color: #00695c; font-weight: bold; display: flex; align-items: center; justify-content: center; font-size: 11px; margin-right: 10px; border: 1px solid #b2dfdb; }
</style>

<body onload="initPage()">
  <div class="d-flex">
    <div id="sidebarWrapper" class="sidebar p-3">
      <button id="sidebarToggleBtn" class="sidebar-toggle-btn"><i id="sidebarToggleIcon" class="bi bi-list"></i></button>
      <div class="profile-icons d-flex justify-content-center mb-3"><div class="profile-icon"><i class="bi bi-person-circle"></i></div></div>
      <div class="text-center mb-4"><h6 class="text-white-50 mb-0 small">WELCOME</h6><h5 class="text-white fw-bold">ADMIN</h5></div>
      <p class="text-secondary small mt-3 fw-bold nav-header" style="padding-left: 10px;">NAVIGATION</p>
      <ul class="nav flex-column gap-1">
        <li class="nav-item"><a class="nav-link d-flex align-items-center" href="dashboard.html"><i class="bi bi-speedometer2 me-2"></i><span class="label">Dashboard</span></a></li>
        <li class="nav-item"><a class="nav-link active d-flex align-items-center" href="appointments.html"><i class="bi bi-calendar-check me-2"></i><span class="label">Appointments</span></a></li>
        <li class="nav-item"><a class="nav-link d-flex align-items-center" href="clients.html"><i class="bi bi-people me-2"></i><span class="label">Clients</span></a></li>
        <li class="nav-item"><a class="nav-link d-flex align-items-center" href="counselors.html"><i class="bi bi-person-badge me-2"></i><span class="label">Counselors</span></a></li>
        <li class="nav-item"><a class="nav-link d-flex align-items-center" href="session_notes.html"><i class="bi bi-file-earmark-text me-2"></i><span class="label">Session Notes</span></a></li>
        <li class="nav-item mt-4"><a class="nav-link text-danger d-flex align-items-center" href="#" data-bs-toggle="modal" data-bs-target="#logoutConfirmModal"><i class="bi bi-box-arrow-right me-2"></i><span class="label">Logout</span></a></li>
      </ul>
    </div>

    <div class="content flex-grow-1">
      <nav class="navbar navbar-expand-lg">
        <button class="btn btn-outline-secondary d-lg-none me-2" id="toggleSidebar"><i class="bi bi-list"></i></button>
        <a class="navbar-brand brand-rgb" href="#">MINDCAREHUB</a>
        <div class="ms-auto d-flex align-items-center gap-3">
          <div class="dropdown">
            <a class="btn btn-light dropdown-toggle d-flex align-items-center gap-2 border-0 bg-transparent" href="#" role="button" data-bs-toggle="dropdown">
              <span class="badge rounded-circle bg-primary text-white p-2" id="topUserBadge">HH</span>
              <span class="fw-bold text-dark small" id="topUserName">Hanis Heidi</span>
            </a>
            <ul class="dropdown-menu dropdown-menu-end shadow-sm border-0">
              <li><a class="dropdown-item" href="#" id="menuProfile"><i class="bi bi-person me-2"></i> Profile</a></li>
              <li><a class="dropdown-item" href="#"><i class="bi bi-gear me-2"></i> Settings</a></li>
              <li><hr class="dropdown-divider"></li>
              <li><a class="dropdown-item text-danger" href="#" onclick="logout()"><i class="bi bi-box-arrow-right me-2"></i> Logout</a></li>
            </ul>
          </div>
        </div>
      </nav>

      <div class="container-fluid p-4 flex-grow-1">
        <div id="mainContent">
          <div class="welcome-card animate-entry"><h1 class="fw-bold mb-2">Appointment <span style="color:#bddeb1;">Management</span></h1><p class="mb-0 text-white-50">Schedule, approve, and track counseling sessions with ease.</p></div>
          
          <div class="row g-3 mb-4 animate-entry delay-1">
             <div class="col-md-3"><div class="stat-card-mini"><div><p class="text-secondary small mb-1 fw-bold">TOTAL APPT</p><h2 class="fw-bold mb-0 text-dark" id="statTotal">0</h2></div><div class="icon-square bg-primary bg-opacity-10 text-primary"><i class="bi bi-calendar-event"></i></div></div></div>
             <div class="col-md-3"><div class="stat-card-mini"><div><p class="text-secondary small mb-1 fw-bold">CONFIRMED</p><h2 class="fw-bold mb-0 text-dark" id="statConfirmed">0</h2></div><div class="icon-square bg-success bg-opacity-10 text-success"><i class="bi bi-check-circle"></i></div></div></div>
             <div class="col-md-3"><div class="stat-card-mini"><div><p class="text-secondary small mb-1 fw-bold">PENDING</p><h2 class="fw-bold mb-0 text-dark" id="statPending">0</h2></div><div class="icon-square bg-warning bg-opacity-10 text-warning"><i class="bi bi-hourglass-split"></i></div></div></div>
             <div class="col-md-3"><div class="stat-card-mini"><div><p class="text-secondary small mb-1 fw-bold">CANCELLED</p><h2 class="fw-bold mb-0 text-dark" id="statCancelled">0</h2></div><div class="icon-square bg-danger bg-opacity-10 text-danger"><i class="bi bi-x-circle"></i></div></div></div>
          </div>

          <h6 class="fw-bold text-secondary small mb-3 animate-entry delay-2"><i class="bi bi-clock-history me-1"></i> UPCOMING SCHEDULE</h6>
          <div class="timeline-wrapper mb-4 animate-entry delay-2" id="timelineContainer"></div>

          <div class="d-flex flex-wrap justify-content-between align-items-center mb-4 gap-2 animate-entry delay-3">
             <div class="d-flex gap-2 flex-grow-1 align-items-center"><div class="input-group shadow-sm" style="max-width: 250px;"><span class="input-group-text bg-white border-end-0"><i class="bi bi-search text-secondary"></i></span><input type="text" id="searchInput" class="form-control border-start-0" placeholder="Search client..."></div><select class="form-select shadow-sm" style="max-width: 150px;" id="statusFilter"><option value="All">All Status</option><option value="Confirmed">Confirmed</option><option value="Pending">Pending</option><option value="Completed">Completed</option></select></div>
             <div class="d-flex gap-2"><div class="btn-group shadow-sm"><button class="btn view-btn active" onclick="switchView('table')"><i class="bi bi-list-task"></i> List</button><button class="btn view-btn" onclick="switchView('kanban')"><i class="bi bi-kanban"></i> Board</button></div><button class="btn btn-green shadow-sm" style="background-color:#bddeb1; color:#102e35" onclick="openAddModal()"><i class="bi bi-plus-lg me-1"></i> New Appointment</button></div>
          </div>

          <div id="tableView" class="table-card mb-5 animate-entry delay-3"><div class="table-responsive"><table class="table table-hover mb-0"><thead><tr><th>ID</th><th>Client</th><th>Counselor</th><th>Date & Time</th><th>Status</th><th class="text-center">Action</th></tr></thead><tbody id="tableBody"></tbody></table></div></div>
          <div id="kanbanView" class="kanban-container hidden-section mb-5 animate-entry delay-3"><div class="kanban-col"><div class="kanban-header"><i class="bi bi-hourglass-split text-warning"></i> Pending Request</div><div id="col-pending"></div></div><div class="kanban-col"><div class="kanban-header"><i class="bi bi-check-circle text-success"></i> Confirmed / Upcoming</div><div id="col-confirmed"></div></div><div class="kanban-col"><div class="kanban-header"><i class="bi bi-archive text-secondary"></i> Completed / History</div><div id="col-completed"></div></div></div>
        </div>

        <section id="profileSection" class="hidden-section mb-5">
          <h2 class="fw-bold text-dark">User Profile</h2>
          <div class="profile-grid">
            <div class="profile-card profile-left-content"><div class="d-flex align-items-center w-100 mb-4"><div class="avatar-large" id="profileAvatarFallback">HH</div><div class="ms-3 text-start"><h4 class="fw-bold mb-0" id="profileDisplayName">Hanis Heidi</h4><span class="badge bg-info bg-opacity-25 text-info rounded-pill">Super Admin</span></div></div><div class="d-flex gap-2 w-100"><button class="btn btn-green flex-grow-1">Change Avatar</button><button class="btn btn-outline-custom flex-grow-1">Reset Password</button></div></div>
            <div class="profile-card form-card"><h5 class="fw-bold mb-3 border-bottom pb-2">Account Details</h5><form id="profileForm"><div class="row g-3 mb-3"><div class="col-md-6"><label class="form-label">First Name</label><input type="text" class="form-control" id="firstName" value="Hanis"></div><div class="col-md-6"><label class="form-label">Last Name</label><input type="text" class="form-control" id="lastName" value="Heidi"></div></div><div class="mb-3"><label class="form-label">Email</label><input type="email" class="form-control" id="email" value="hanis@mindcare.com"></div><div class="d-flex justify-content-end gap-2"><button type="button" class="btn btn-outline-custom px-4" id="backToMainBtn">Back</button><button type="submit" class="btn btn-green px-4">Save</button></div></form></div>
          </div>
        </section>
      </div>

      <footer>
        <div class="container-fluid px-5">
          <div class="row align-items-center text-center text-md-start">
            <div class="col-md-4 mb-3 mb-md-0"><h2 class="brand-rgb">MindCareHub</h2></div>
            <div class="col-md-4 mb-3 mb-md-0 text-center"><div class="d-flex justify-content-center mb-2"><a href="#" class="social-icon-btn"><i class="bi bi-instagram"></i></a><a href="#" class="social-icon-btn"><i class="bi bi-twitter-x"></i></a><a href="#" class="social-icon-btn"><i class="bi bi-facebook"></i></a></div><a href="#" class="fw-bold text-muted">mindcarehub@gmail.com</a></div>
            <div class="col-md-4 text-center text-md-end"><div class="footer-links mb-2"><a href="#">Privacy</a><a href="#">Terms</a><a href="#">Help</a></div><p class="mb-0 small text-muted">&copy; <span id="yearSpan"></span> MindCareHub.</p></div>
          </div>
        </div>
      </footer>
    </div>
  </div>

  <div class="modal fade" id="apptModal" tabindex="-1"><div class="modal-dialog modal-dialog-centered"><div class="modal-content"><div class="modal-header" style="background-color:#bddeb1"><h5 class="modal-title fw-bold" style="color:#102e35">Appointment</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><form id="apptForm"><input type="hidden" id="editId"><div class="mb-3"><label class="fw-bold small">Client</label><select class="form-select" id="aClient" required></select></div><div class="mb-3"><label class="fw-bold small">Counselor</label><select class="form-select" id="aCounselor" required></select></div><div class="row mb-3"><div class="col-6"><label class="fw-bold small">Date</label><input type="date" class="form-control" id="aDate" required></div><div class="col-6"><label class="fw-bold small">Time</label><input type="time" class="form-control" id="aTime" required></div></div><div class="row mb-3"><div class="col-6"><label class="fw-bold small">Mode</label><select class="form-select" id="aMode"><option>In-Person</option><option>Online (Zoom)</option></select></div><div class="col-6"><label class="fw-bold small">Status</label><select class="form-select" id="aStatus"><option>Pending</option><option>Confirmed</option><option>Completed</option><option>Cancelled</option></select></div></div><div class="text-end"><button type="submit" class="btn btn-success" style="background-color:#bddeb1; color:#102e35; border:none">Save</button></div></form></div></div></div></div>
  <div class="modal fade" id="logoutConfirmModal" tabindex="-1"><div class="modal-dialog modal-dialog-centered"><div class="modal-content"><div class="modal-header bg-light"><h5 class="modal-title fw-bold">Confirm Logout</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body">Are you sure?</div><div class="modal-footer"><button class="btn btn-light" data-bs-dismiss="modal">Cancel</button><button onclick="logout()" class="btn btn-danger">Logout</button></div></div></div></div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    const KEY_APPTS = 'mindcare_appointments_data'; const KEY_CLIENTS = 'mindcare_clients_data'; const KEY_COUNSELORS = 'mindcare_counselors_data';
    let apptData = JSON.parse(localStorage.getItem(KEY_APPTS)) || []; let clientList = JSON.parse(localStorage.getItem(KEY_CLIENTS)) || []; let counselorList = JSON.parse(localStorage.getItem(KEY_COUNSELORS)) || [];
    if(clientList.length === 0) clientList = [{name:"Nur Aina"}, {name:"Jason Lim"}, {name:"Siti Mariam"}, {name:"Daniel Wong"}, {name:"Amira Sofea"}, {name:"Kelvin Tan"}];
    if(counselorList.length === 0) counselorList = [{name:"Dr. Farah Ahmad"}, {name:"Mr. Hafiz Rahman"}, {name:"Ms. Priya Nair"}];
    if(apptData.length === 0) {
        apptData = [{id: "APT001", client: "Nur Aina", counselor: "Dr. Farah Ahmad", date: "2025-12-28", time: "10:00 AM", status: "Confirmed"},{id: "APT002", client: "Jason Lim", counselor: "Mr. Hafiz Rahman", date: "2025-12-28", time: "11:30 AM", status: "Pending"},{id: "APT003", client: "Siti Mariam", counselor: "Dr. Farah Ahmad", date: "2025-12-28", time: "02:00 PM", status: "Completed"},{id: "APT004", client: "Daniel Wong", counselor: "Ms. Priya Nair", date: "2025-12-29", time: "09:00 AM", status: "Confirmed"},{id: "APT005", client: "Amira Sofea", counselor: "Mr. Hafiz Rahman", date: "2025-12-29", time: "03:30 PM", status: "Cancelled"},{id: "APT006", client: "Kelvin Tan", counselor: "Ms. Priya Nair", date: "2025-12-30", time: "01:00 PM", status: "Pending"}];
        for(let i=0; i<8; i++) { const client = clientList[Math.floor(Math.random() * clientList.length)]; const counselor = counselorList[Math.floor(Math.random() * counselorList.length)]; apptData.push({ id: `APT${(i+7).toString().padStart(3,'0')}`, client: client.name, counselor: counselor.name, date: `2025-12-${30+i}`, time: "10:00 AM", mode: "In-Person", status: ["Pending", "Confirmed"][Math.floor(Math.random()*2)] }); } localStorage.setItem(KEY_APPTS, JSON.stringify(apptData));
    }
    function initPage() { document.getElementById('yearSpan').textContent = new Date().getFullYear(); populateDropdowns(); renderTable(); renderTimeline(); updateStats(); document.getElementById('searchInput').addEventListener('input', refreshView); document.getElementById('statusFilter').addEventListener('change', refreshView); }
    function populateDropdowns() { const cSelect = document.getElementById('aClient'); const drSelect = document.getElementById('aCounselor'); cSelect.innerHTML = ""; drSelect.innerHTML = ""; clientList.forEach(c => { cSelect.innerHTML += `<option>${c.name}</option>`; }); counselorList.forEach(c => { drSelect.innerHTML += `<option>${c.name}</option>`; }); }
    function refreshView() { if(!document.getElementById('tableView').classList.contains('hidden-section')) renderTable(); else renderKanban(); }
    function switchView(view) { document.querySelectorAll('.view-btn').forEach(b => b.classList.remove('active')); event.currentTarget.classList.add('active'); if(view === 'table') { document.getElementById('tableView').classList.remove('hidden-section'); document.getElementById('kanbanView').classList.add('hidden-section'); renderTable(); } else { document.getElementById('tableView').classList.add('hidden-section'); document.getElementById('kanbanView').classList.remove('hidden-section'); renderKanban(); } }
    function getFilteredData() { const q = document.getElementById('searchInput').value.toLowerCase(); const s = document.getElementById('statusFilter').value; return apptData.filter(a => (a.client.toLowerCase().includes(q) || a.counselor.toLowerCase().includes(q) || a.id.toLowerCase().includes(q)) && (s === 'All' || a.status === s)); }
    function renderTable() { const tbody = document.getElementById('tableBody'); tbody.innerHTML = ""; getFilteredData().forEach(a => { const badge = getStatusBadge(a.status); let actionBtn = `<button class="btn btn-sm btn-light border" onclick="editAppt('${a.id}')"><i class="bi bi-pencil"></i> Edit</button>`; if(a.status === 'Pending') actionBtn = `<button class="btn btn-sm btn-success text-white py-0" onclick="setStatus('${a.id}','Confirmed')">Approve</button>`; else if(a.status === 'Confirmed') actionBtn = `<button class="btn btn-sm btn-primary py-0" onclick="setStatus('${a.id}','Completed')">Complete</button>`; tbody.innerHTML += `<tr><td class="fw-bold small text-secondary">${a.id}</td><td class="fw-bold"><div class="d-flex align-items-center"><div class="avatar-text">${getInitials(a.client)}</div>${a.client}</div></td><td><div class="d-flex align-items-center"><div class="avatar-text bg-light text-dark">${getInitials(a.counselor)}</div>${a.counselor}</div></td><td class="small">${a.date} <br> <span class="text-muted">${a.time}</span></td><td class="text-center"><span class="badge ${badge} rounded-pill">${a.status}</span></td><td class="text-center">${actionBtn} <button class="btn btn-sm btn-light border ms-1" onclick="deleteAppt('${a.id}')"><i class="bi bi-trash text-danger"></i></button></td></tr>`; }); }
    function renderKanban() { const p = document.getElementById('col-pending'); const c = document.getElementById('col-confirmed'); const h = document.getElementById('col-completed'); p.innerHTML = ""; c.innerHTML = ""; h.innerHTML = ""; getFilteredData().forEach(a => { let cardHtml = `<div class="kanban-card"><div class="d-flex justify-content-between mb-2"><span class="badge bg-light text-dark border">${a.id}</span><small class="text-muted">${a.date}</small></div><h6 class="fw-bold mb-1">${a.client}</h6><p class="small text-muted mb-2">with ${a.counselor}</p><div class="d-flex gap-1 mt-2"><button class="btn btn-sm btn-light border flex-grow-1" onclick="editAppt('${a.id}')">Edit</button>${getKanbanAction(a)}</div></div>`; if(a.status === 'Pending') p.innerHTML += cardHtml; else if(a.status === 'Confirmed') c.innerHTML += cardHtml; else h.innerHTML += cardHtml; }); }
    function renderTimeline() { const cont = document.getElementById('timelineContainer'); cont.innerHTML = ""; apptData.filter(a => a.status === 'Confirmed' || a.status === 'Pending').slice(0, 6).forEach(a => { const borderClass = a.status === 'Pending' ? 'pending' : ''; cont.innerHTML += `<div class="timeline-card ${borderClass}"><div class="time-badge">${a.time}</div><h6 class="fw-bold mb-0">${a.client}</h6><small class="text-muted">with ${a.counselor}</small><div class="mt-2 text-muted small">${a.date}</div></div>`; }); }
    function getStatusBadge(s) { if(s==='Confirmed') return 'bg-success bg-opacity-10 text-success border border-success'; if(s==='Pending') return 'bg-warning bg-opacity-10 text-warning border border-warning'; return 'bg-secondary bg-opacity-10 text-secondary'; }
    function getInitials(n) { return n.split(" ").map(x=>x[0]).join("").substring(0,2); }
    function getKanbanAction(a) { if(a.status==='Pending') return `<button class="btn btn-sm btn-success text-white flex-grow-1" onclick="setStatus('${a.id}','Confirmed')">Approve</button>`; if(a.status==='Confirmed') return `<button class="btn btn-sm btn-primary text-white flex-grow-1" onclick="setStatus('${a.id}','Completed')">Complete</button>`; return ''; }
    function updateStats() { document.getElementById('statTotal').innerText = apptData.length; }
    function openAddModal() { document.getElementById('editId').value = ""; document.getElementById('apptForm').reset(); new bootstrap.Modal(document.getElementById('apptModal')).show(); }
    function editAppt(id) { const a = apptData.find(x => x.id === id); if(!a) return; document.getElementById('editId').value = a.id; document.getElementById('aClient').value = a.client; document.getElementById('aCounselor').value = a.counselor; document.getElementById('aDate').value = a.date; document.getElementById('aStatus').value = a.status; new bootstrap.Modal(document.getElementById('apptModal')).show(); }
    document.getElementById('apptForm').addEventListener('submit', (e) => { e.preventDefault(); const editId = document.getElementById('editId').value; const form = { client: document.getElementById('aClient').value, counselor: document.getElementById('aCounselor').value, date: document.getElementById('aDate').value, time: document.getElementById('aTime').value, mode: document.getElementById('aMode').value, status: document.getElementById('aStatus').value }; if(editId) { const idx = apptData.findIndex(a => a.id === editId); if(idx !== -1) apptData[idx] = { ...apptData[idx], ...form }; } else { const newId = `APT${(parseInt(apptData[apptData.length-1].id.substring(3)) + 1)}`; apptData.push({ id: newId, ...form }); } localStorage.setItem(KEY_APPTS, JSON.stringify(apptData)); updateStats(); refreshView(); renderTimeline(); bootstrap.Modal.getInstance(document.getElementById('apptModal')).hide(); });
    function setStatus(id, status) { const idx = apptData.findIndex(a => a.id === id); if(idx !== -1) { apptData[idx].status = status; localStorage.setItem(KEY_APPTS, JSON.stringify(apptData)); updateStats(); refreshView(); renderTimeline(); } }
    function deleteAppt(id) { if(confirm("Delete?")) { apptData = apptData.filter(a => a.id !== id); localStorage.setItem(KEY_APPTS, JSON.stringify(apptData)); updateStats(); refreshView(); renderTimeline(); } }
    const sidebar = document.getElementById("sidebarWrapper"); document.getElementById("sidebarToggleBtn").addEventListener("click", () => sidebar.classList.toggle("collapsed")); document.getElementById("toggleSidebar").addEventListener("click", () => sidebar.classList.toggle("collapsed")); document.getElementById("menuProfile").addEventListener("click", (e) => { e.preventDefault(); document.getElementById("mainContent").classList.add("hidden-section"); document.getElementById("profileSection").classList.remove("hidden-section"); }); document.getElementById("backToMainBtn").addEventListener("click", () => { document.getElementById("profileSection").classList.add("hidden-section"); document.getElementById("mainContent").classList.remove("hidden-section"); }); function logout() { window.location.href = "login.html"; }
  </script>
</body>
</html>